module.exports=[6251,e=>{"use strict";var t=e.i(58170),i=e.i(71747),r=e.i(91468),s=e.i(16517),a=e.i(49796),n=e.i(16408),o=e.i(98493),l=e.i(38514),u=e.i(7705),h=e.i(45629),d=e.i(29100),p=e.i(22767),w=e.i(97799),c=e.i(64496),f=e.i(32177),y=e.i(58320),g=e.i(93695);e.i(8022);var E=e.i(5515),m=e.i(33406),_=e.i(33780);class R{buffer=[];_position=0;localMessageTypes=new Map;get position(){return this._position}writeHeader(){this.writeByte(14),this.writeByte(32),this.writeUInt16LE(2069),this.writeUInt32LE(0),this.writeBytes([46,70,73,84]),this.writeUInt16LE(0)}writeFileIdMessage(){this.writeDefinitionMessage(0,0,[{fieldNum:0,size:1,baseType:0},{fieldNum:1,size:2,baseType:132},{fieldNum:2,size:2,baseType:132},{fieldNum:3,size:4,baseType:134},{fieldNum:4,size:4,baseType:134}]),this.writeDataMessageHeader(0),this.writeByte(5),this.writeUInt16LE(1),this.writeUInt16LE(1),this.writeUInt32LE(12345),this.writeUInt32LE(Math.floor(Date.now()/1e3)-0x259d4c00)}writeWorkoutMessage(e){let t=this.stringToBytes(e,64);this.writeDefinitionMessage(26,1,[{fieldNum:4,size:1,baseType:0},{fieldNum:5,size:1,baseType:0},{fieldNum:6,size:2,baseType:132},{fieldNum:8,size:t.length,baseType:7}]),this.writeDataMessageHeader(1),this.writeByte(1),this.writeByte(0),this.writeUInt16LE(10),this.writeBytes(t)}writeWorkoutStep(e,t){if("repeat"===e.type&&e.segments&&e.repeat_count){let i=t;for(let i of e.segments)t=this.writeWorkoutStep(i,t);return this.writeStepDefinition(2),this.writeDataMessageHeader(2),this.writeUInt16LE(t),this.writeByte(6),this.writeUInt32LE(i),this.writeByte(2),this.writeUInt32LE(0),this.writeUInt32LE(0),this.writeUInt32LE(e.repeat_count),this.writeByte(5),t+1}this.writeStepDefinition(2),this.writeDataMessageHeader(2);let i=3,r=0;"time"===e.duration_type&&e.duration_value?(i=0,r=1e3*e.duration_value):"distance"===e.duration_type&&e.duration_value&&(i=1,r=100*e.duration_value);let s=2,a=0,n=0;if("pace"===e.target_type||e.target_pace_low||e.target_pace_high)s=6,e.target_pace_low&&(n=Math.round(1e3/e.target_pace_low*1e3)),e.target_pace_high&&(a=Math.round(1e3/e.target_pace_high*1e3));else if("heart_rate_zone"===e.target_type&&e.target_zone){s=1;let t={1:[50,60],2:[60,70],3:[70,80],4:[80,90],5:[90,100]}[e.target_zone]||[50,100];a=t[0]+100,n=t[1]+100}let o=0;switch(e.type){case"warmup":o=2;break;case"cooldown":o=3;break;case"recovery":o=4;break;case"interval":o=5;break;case"rest":o=1}return this.writeUInt16LE(t),this.writeByte(i),this.writeUInt32LE(r),this.writeByte(s),this.writeUInt32LE(a),this.writeUInt32LE(n),this.writeByte(o),t+1}writeSimpleWorkoutSteps(e,t){let i=Math.round(.1*(e.target_duration_minutes||30)*6e4);this.writeStepDefinition(2),this.writeDataMessageHeader(2),this.writeUInt16LE(t++),this.writeByte(0),this.writeUInt32LE(i),this.writeByte(2),this.writeUInt32LE(0),this.writeUInt32LE(0),this.writeByte(2);let r=Math.round(.8*(e.target_duration_minutes||30)*6e4);this.writeStepDefinition(2),this.writeDataMessageHeader(2),this.writeUInt16LE(t++),this.writeByte(0),this.writeUInt32LE(r),this.writeByte(2),this.writeUInt32LE(0),this.writeUInt32LE(0),this.writeByte(0);let s=Math.round(.1*(e.target_duration_minutes||30)*6e4);return this.writeStepDefinition(2),this.writeDataMessageHeader(2),this.writeUInt16LE(t++),this.writeByte(0),this.writeUInt32LE(s),this.writeByte(2),this.writeUInt32LE(0),this.writeUInt32LE(0),this.writeByte(3),t}writeStepDefinition(e){this.localMessageTypes.has(e)||(this.writeDefinitionMessage(27,e,[{fieldNum:254,size:2,baseType:132},{fieldNum:0,size:1,baseType:0},{fieldNum:1,size:4,baseType:134},{fieldNum:2,size:1,baseType:0},{fieldNum:3,size:4,baseType:134},{fieldNum:4,size:4,baseType:134},{fieldNum:5,size:1,baseType:0}]),this.localMessageTypes.set(e,27))}writeDefinitionMessage(e,t,i){for(let r of(this.writeByte(64|t),this.writeByte(0),this.writeByte(0),this.writeUInt16LE(e),this.writeByte(i.length),i))this.writeByte(r.fieldNum),this.writeByte(r.size),this.writeByte(r.baseType);this.localMessageTypes.set(t,e)}writeDataMessageHeader(e){this.writeByte(e)}finalize(){let e=this.buffer.length-14;this.buffer[4]=255&e,this.buffer[5]=e>>8&255,this.buffer[6]=e>>16&255,this.buffer[7]=e>>24&255;let t=this.calculateCrc(this.buffer.slice(0,12));this.buffer[12]=255&t,this.buffer[13]=t>>8&255;let i=this.calculateCrc(this.buffer);this.writeByte(255&i),this.writeByte(i>>8&255)}getBuffer(){return Buffer.from(this.buffer)}writeByte(e){this.buffer.push(255&e),this._position++}writeBytes(e){for(let t of e)this.writeByte(t)}writeUInt16LE(e){this.writeByte(255&e),this.writeByte(e>>8&255)}writeUInt32LE(e){this.writeByte(255&e),this.writeByte(e>>8&255),this.writeByte(e>>16&255),this.writeByte(e>>24&255)}stringToBytes(e,t){let i=[];for(let r of new TextEncoder().encode(e.substring(0,t-1)))i.push(r);for(i.push(0);i.length<t;)i.push(0);return i.slice(0,t)}calculateCrc(e){let t=[0,52225,55297,5120,61441,15360,10240,58369,40961,27648,30720,46081,20480,39937,34817,17408],i=0;for(let r of e){let e=t[15&i];i=(i=i>>4&4095)^e^t[15&r],e=t[15&i],i=(i=i>>4&4095)^e^t[r>>4&15]}return i}}async function b(e,{params:t}){let{workoutId:i}=await t;try{let e=await (0,_.createClient)(),{data:{user:t}}=await e.auth.getUser();if(!t)return m.NextResponse.json({error:"Unauthorized"},{status:401});let{data:r,error:s}=await e.from("workouts").select("*").eq("id",i).eq("user_id",t.id).single();if(s||!r)return m.NextResponse.json({error:"Workout not found"},{status:404});let a=function(e){let t=new R;t.position,t.writeHeader(),t.writeFileIdMessage(),t.writeWorkoutMessage(e.title);let i=0;if(e.workout_structure?.segments)for(let r of e.workout_structure.segments)i=t.writeWorkoutStep(r,i);else i=t.writeSimpleWorkoutSteps(e,i);return t.finalize(),t.getBuffer()}({title:r.title,workout_type:r.workout_type,workout_structure:r.workout_structure,target_duration_minutes:r.target_duration_minutes,target_distance_km:r.target_distance_km?Number(r.target_distance_km):null}),n=`${r.title.replace(/[^a-zA-Z0-9]/g,"_")}.fit`;return new m.NextResponse(new Uint8Array(a),{status:200,headers:{"Content-Type":"application/octet-stream","Content-Disposition":`attachment; filename="${n}"`,"Content-Length":a.length.toString()}})}catch(e){return console.error("FIT generation error:",e),m.NextResponse.json({error:"Failed to generate FIT file"},{status:500})}}e.s(["GET",()=>b],83836);var I=e.i(83836);let v=new t.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/workouts/[workoutId]/fit/route",pathname:"/api/workouts/[workoutId]/fit",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/web/src/app/api/workouts/[workoutId]/fit/route.ts",nextConfigOutput:"",userland:I}),{workAsyncStorage:T,workUnitAsyncStorage:B,serverHooks:U}=v;function N(){return(0,r.patchFetch)({workAsyncStorage:T,workUnitAsyncStorage:B})}async function k(e,t,r){v.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let m="/api/workouts/[workoutId]/fit/route";m=m.replace(/\/index$/,"")||"/";let _=await v.prepare(e,t,{srcPage:m,multiZoneDraftMode:!1});if(!_)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:R,params:b,nextConfig:I,parsedUrl:T,isDraftMode:B,prerenderManifest:U,routerServerContext:N,isOnDemandRevalidate:k,revalidateOnlyGenerated:M,resolvedPathname:C,clientReferenceManifest:L,serverActionsManifest:x}=_,S=(0,l.normalizeAppPath)(m),D=!!(U.dynamicRoutes[S]||U.routes[C]),A=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,T,!1):t.end("This page could not be found"),null);if(D&&!B){let e=!!U.routes[C],t=U.dynamicRoutes[S];if(t&&!1===t.fallback&&!e){if(I.experimental.adapterPath)return await A();throw new g.NoFallbackError}}let H=null;!D||v.isDev||B||(H="/index"===(H=C)?"/":H);let z=!0===v.isDev||!D,P=D&&!z;x&&L&&(0,n.setReferenceManifestsSingleton)({page:m,clientReferenceManifest:L,serverActionsManifest:x,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:x})});let O=e.method||"GET",q=(0,a.getTracer)(),F=q.getActiveScopeSpan(),$={params:b,prerenderManifest:U,renderOpts:{experimental:{authInterrupts:!!I.experimental.authInterrupts},cacheComponents:!!I.cacheComponents,supportsDynamicResponse:z,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:I.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,i,r)=>v.onRequestError(e,t,r,N)},sharedContext:{buildId:R}},j=new u.NodeNextRequest(e),W=new u.NodeNextResponse(t),K=h.NextRequestAdapter.fromNodeNextRequest(j,(0,h.signalFromNodeResponse)(t));try{let n=async e=>v.handle(K,$).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let i=q.getRootSpanAttributes();if(!i)return;if(i.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${i.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=i.get("next.route");if(r){let t=`${O} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${O} ${m}`)}),o=!!(0,s.getRequestMeta)(e,"minimalMode"),l=async s=>{var a,l;let u=async({previousCacheEntry:i})=>{try{if(!o&&k&&M&&!i)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await n(s);e.fetchMetrics=$.renderOpts.fetchMetrics;let l=$.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let u=$.renderOpts.collectedTags;if(!D)return await (0,w.sendResponse)(j,W,a,$.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,c.toNodeOutgoingHttpHeaders)(a.headers);u&&(t[y.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let i=void 0!==$.renderOpts.collectedRevalidate&&!($.renderOpts.collectedRevalidate>=y.INFINITE_CACHE)&&$.renderOpts.collectedRevalidate,r=void 0===$.renderOpts.collectedExpire||$.renderOpts.collectedExpire>=y.INFINITE_CACHE?void 0:$.renderOpts.collectedExpire;return{value:{kind:E.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:i,expire:r}}}}catch(t){throw(null==i?void 0:i.isStale)&&await v.onRequestError(e,t,{routerKind:"App Router",routePath:m,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:P,isOnDemandRevalidate:k})},N),t}},h=await v.handleResponse({req:e,nextConfig:I,cacheKey:H,routeKind:i.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:U,isRoutePPREnabled:!1,isOnDemandRevalidate:k,revalidateOnlyGenerated:M,responseGenerator:u,waitUntil:r.waitUntil,isMinimalMode:o});if(!D)return null;if((null==h||null==(a=h.value)?void 0:a.kind)!==E.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==h||null==(l=h.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",k?"REVALIDATED":h.isMiss?"MISS":h.isStale?"STALE":"HIT"),B&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,c.fromNodeOutgoingHttpHeaders)(h.value.headers);return o&&D||d.delete(y.NEXT_CACHE_TAGS_HEADER),!h.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,f.getCacheControlHeader)(h.cacheControl)),await (0,w.sendResponse)(j,W,new Response(h.value.body,{headers:d,status:h.value.status||200})),null};F?await l(F):await q.withPropagatedContext(e.headers,()=>q.trace(d.BaseServerSpan.handleRequest,{spanName:`${O} ${m}`,kind:a.SpanKind.SERVER,attributes:{"http.method":O,"http.target":e.url}},l))}catch(t){if(t instanceof g.NoFallbackError||await v.onRequestError(e,t,{routerKind:"App Router",routePath:S,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:P,isOnDemandRevalidate:k})}),D)throw t;return await (0,w.sendResponse)(j,W,new Response(null,{status:500})),null}}e.s(["handler",()=>k,"patchFetch",()=>N,"routeModule",()=>v,"serverHooks",()=>U,"workAsyncStorage",()=>T,"workUnitAsyncStorage",()=>B],6251)}];

//# sourceMappingURL=0b804_next_dist_esm_build_templates_app-route_233ee84b.js.map